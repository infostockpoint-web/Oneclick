<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF to Word - One Click Tools</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:12px; align-items:end; }
    .progress { height:10px; background:#eef2ff; border-radius:6px; overflow:hidden; }
    .bar { height:100%; width:0%; background:#4a6cf7; transition:width .2s ease; }
    .hint { font-size:.9rem; color:#6b7280; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.3.2/docx.min.js"></script>
</head>
<body>
  <div id="site-header"></div>
  <main class="container" style="padding:60px 0;">
    <div class="tool-card" style="max-width:980px; margin:0 auto;">
      <div style="text-align:center; margin-bottom:10px;">
        <i class="fas fa-file-word tool-icon-small" style="font-size:3rem;"></i>
        <div class="tool-name" style="font-size:1.6rem;">PDF to Word (.docx)</div>
        <div class="tool-desc">Extract text from your PDF and generate a .docx document. Layout fidelity will be basic (text-only).</div>
      </div>

      <div class="tool-card" style="padding:16px;">
        <div class="grid">
          <div>
            <label for="pdfInput" style="display:block; font-weight:600; margin-bottom:6px;">Select PDF File</label>
            <input type="file" id="pdfInput" accept="application/pdf,.pdf" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;">
          </div>
          <div>
            <label for="pageRange" style="display:block; font-weight:600; margin-bottom:6px;">Page Range (optional)</label>
            <input type="text" id="pageRange" placeholder="e.g., 1-3,5" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;">
            <div class="hint">This is a text-only conversion.</div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button id="convertBtn" class="tool-button"><i class="fas fa-file-export"></i> Convert to .docx</button>
            <button id="clearBtn" class="tool-button" style="background:#888;"><i class="fas fa-eraser"></i> Clear</button>
          </div>
        </div>
        <div style="margin-top:12px;" class="progress"><div class="bar" id="progressBar"></div></div>
      </div>

      <div class="tool-card" style="padding:16px; margin-top:16px;">
        <div class="tool-name">Details</div>
        <div id="details" style="margin-top:8px; color:#374151; font-size:.95rem;">Select a PDF to begin.</div>
      </div>

      <div class="banner-ad" style="margin-top:16px;">Ad Placeholder (728x90)</div>
      <div style="text-align:center; margin-top:8px;">
        <a class="tool-button" href="../index.html">Back to Home</a>
      </div>
    </div>
  </main>
  <div id="site-footer"></div>
  <script src="../js/include.js"></script>
  <script>
    if (window.pdfjsLib && pdfjsLib.GlobalWorkerOptions) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
    const pdfInput = document.getElementById('pdfInput');
    const pageRange = document.getElementById('pageRange');
    const convertBtn = document.getElementById('convertBtn');
    const clearBtn = document.getElementById('clearBtn');
    const details = document.getElementById('details');
    const progressBar = document.getElementById('progressBar');

    function setProgress(p){ progressBar.style.width = Math.max(0, Math.min(100, p)) + '%'; }
    function reset(){ details.textContent='Select a PDF to begin.'; setProgress(0); }
    clearBtn.addEventListener('click', ()=>{ pdfInput.value=''; pageRange.value=''; reset(); });
    pdfInput.addEventListener('change', ()=>{ reset(); if (pdfInput.files[0]) details.textContent = `Selected: ${pdfInput.files[0].name}`; });

    function parseRange(rangeStr, total){
      if (!rangeStr || !rangeStr.trim()) return Array.from({length: total}, (_,i)=>i+1);
      const out = new Set();
      rangeStr.split(',').forEach(p => { const t = p.trim(); if (!t) return; if (t.includes('-')) { const [a,b] = t.split('-').map(n=>parseInt(n,10)); const s=Math.max(1,isNaN(a)?1:a); const e=Math.min(total,isNaN(b)?total:b); for(let i=s;i<=e;i++) out.add(i); } else { const n=parseInt(t,10); if(n>=1&&n<=total) out.add(n);} });
      return Array.from(out).sort((a,b)=>a-b);
    }

    async function extractText(file){
      const buf = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: buf }).promise;
      const pages = parseRange(pageRange.value, pdf.numPages);
      let blocks = [];
      for (let i=0;i<pages.length;i++){
        const pNum = pages[i];
        const page = await pdf.getPage(pNum);
        const tc = await page.getTextContent();
        const text = tc.items.map(it => it.str).join(' ');
        blocks.push({ page: pNum, text });
        setProgress(Math.round(((i+1)/pages.length)*100));
      }
      return blocks;
    }

    convertBtn.addEventListener('click', async () => {
      if (!pdfInput.files[0]) { alert('Please select a PDF file.'); return; }
      try {
        convertBtn.disabled = true; convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
        const blocks = await extractText(pdfInput.files[0]);
        const { Document, Packer, Paragraph, HeadingLevel } = window.docx || {};
        if (!Document) { alert('docx library failed to load.'); return; }
        const children = [];
        children.push(new Paragraph({ text: 'Converted from PDF', heading: HeadingLevel.TITLE }));
        blocks.forEach(b => {
          children.push(new Paragraph({ text: `Page ${b.page}`, heading: HeadingLevel.HEADING_2 }));
          String(b.text || '').split(/\n+/).forEach(line => { if (line.trim()) children.push(new Paragraph(line)); });
        });
        const doc = new Document({ sections: [{ properties:{}, children }] });
        const blob = await Packer.toBlob(doc);
        const base = (pdfInput.files[0]?.name || 'document').replace(/\.pdf$/i,'');
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = base + '.docx';
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
        URL.revokeObjectURL(url);
        details.textContent = `Created ${base}.docx`;
      } catch(e){
        alert('Failed to create Word document: ' + e.message);
      } finally {
        convertBtn.disabled = false; convertBtn.innerHTML = '<i class="fas fa-file-export"></i> Convert to .docx';
      }
    });
  </script>
</body>
</html>



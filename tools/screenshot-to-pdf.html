<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Screenshot to PDF â€” One Click</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <link rel="icon" href="../assets/images/favicon.ico" />
</head>
<body>
  <div id="header-container"></div>

  <main class="tool-container">
    <div class="tool-header">
      <h1>Screenshot to PDF Converter</h1>
      <p>Convert an image (screenshot/photo) to a PDF. Processing happens in your browser.</p>
    </div>

    <div class="tool-interface">
      <div class="form-group">
        <label for="imgInput">Choose image</label>
        <input id="imgInput" type="file" accept="image/*" class="form-control" />
      </div>

      <div class="d-flex" style="gap:10px;flex-wrap:wrap;">
        <div>
          <label for="pageSize">Page Size</label>
          <select id="pageSize" class="form-control">
            <option value="a4">A4</option>
            <option value="letter">Letter</option>
          </select>
        </div>
        <div>
          <label for="orientation">Orientation</label>
          <select id="orientation" class="form-control">
            <option value="p">Portrait</option>
            <option value="l">Landscape</option>
          </select>
        </div>
        <div>
          <label for="fitMode">Fit Mode</label>
          <select id="fitMode" class="form-control">
            <option value="contain">Contain (keep aspect)</option>
            <option value="cover">Cover</option>
            <option value="stretch">Stretch</option>
          </select>
        </div>
      </div>

      <div class="d-flex mt-3" style="gap:10px;flex-wrap:wrap;">
        <button id="downloadBtn" class="btn btn-primary" disabled>Download PDF</button>
      </div>

      <div id="preview" class="mt-3"></div>
    </div>

    <div class="ad-space"><h4>Advertisement</h4><p>300x250</p></div>
  </main>

  <div id="footer-container"></div>

  <script src="../assets/js/common.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const { jsPDF } = window.jspdf || {};

    const input = document.getElementById('imgInput');
    const preview = document.getElementById('preview');
    const btn = document.getElementById('downloadBtn');

    let imgDataUrl = null;

    input.addEventListener('change', () => {
      const file = input.files && input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        imgDataUrl = e.target.result;
        preview.innerHTML = `<img src="${imgDataUrl}" alt="Preview" style="max-width:100%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);"/>`;
        btn.disabled = false;
        showNotification('Image ready for PDF export', 'success');
      };
      reader.readAsDataURL(file);
    });

    btn.addEventListener('click', () => {
      if (!imgDataUrl) return;
      const size = document.getElementById('pageSize').value; // 'a4' or 'letter'
      const orientation = document.getElementById('orientation').value; // 'p' or 'l'
      const fit = document.getElementById('fitMode').value; // contain/cover/stretch

      const doc = new jsPDF({ orientation, unit: 'pt', format: size });
      const pageW = doc.internal.pageSize.getWidth();
      const pageH = doc.internal.pageSize.getHeight();

      const img = new Image();
      img.onload = () => {
        let drawW = pageW, drawH = pageH, x = 0, y = 0;
        const imgRatio = img.width / img.height;
        const pageRatio = pageW / pageH;

        if (fit === 'contain') {
          if (imgRatio > pageRatio) { drawW = pageW; drawH = pageW / imgRatio; y = (pageH - drawH)/2; }
          else { drawH = pageH; drawW = pageH * imgRatio; x = (pageW - drawW)/2; }
        } else if (fit === 'cover') {
          if (imgRatio > pageRatio) { drawH = pageH; drawW = pageH * imgRatio; x = (pageW - drawW)/2; }
          else { drawW = pageW; drawH = pageW / imgRatio; y = (pageH - drawH)/2; }
        } else { // stretch
          drawW = pageW; drawH = pageH; x = 0; y = 0;
        }

        doc.addImage(img, 'PNG', x, y, drawW, drawH);
        doc.save('screenshot.pdf');
      };
      img.src = imgDataUrl;
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Code Assistant - One Click Tools</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .code-assistant {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .ai-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .ai-header h1 {
      font-size: 2.2rem;
      color: #2c3e50;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .ai-header p {
      color: #7f8c8d;
      font-size: 1.1rem;
      max-width: 700px;
      margin: 0 auto 20px;
    }
    
    .assistant-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 900px) {
      .assistant-container {
        grid-template-columns: 1fr;
      }
    }
    
    .input-section, .output-section {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .section-header {
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .section-title {
      font-size: 1.1rem;
      color: #2c3e50;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .code-container {
      flex: 1;
      position: relative;
    }
    
    .CodeMirror {
      height: 100%;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .controls {
      padding: 15px 20px;
      background: #f8f9fa;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .language-selector {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.95rem;
      min-width: 150px;
    }
    
    .action-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }
    
    .generate-btn {
      background: #4a6cf7;
      color: white;
    }
    
    .generate-btn:hover {
      background: #3a5ce4;
    }
    
    .generate-btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }
    
    .clear-btn {
      background: #f8f9fa;
      color: #6c757d;
      border: 1px solid #dee2e6;
    }
    
    .clear-btn:hover {
      background: #e9ecef;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      z-index: 10;
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4a6cf7;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      color: #e74c3c;
      background: #fde8e8;
      padding: 10px 15px;
      border-radius: 4px;
      margin: 10px 20px;
      display: none;
    }
    
    .suggestions {
      margin-top: 20px;
    }
    
    .suggestions h3 {
      font-size: 1.1rem;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    
    .suggestion-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .suggestion-tag {
      background: #f0f4f8;
      color: #4a6cf7;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid #dee2e6;
    }
    
    .suggestion-tag:hover {
      background: #e2e8f0;
    }
    
    .coming-soon-banner {
      background: #f8f9fa;
      padding: 15px;
      text-align: center;
      color: #6c757d;
      border-radius: 8px;
      margin-top: 30px;
      border: 1px dashed #dee2e6;
    }
  </style>
</head>
<body>
  <div id="site-header"></div>
  
  <main class="code-assistant">
    <div class="ai-header">
      <h1><i class="fas fa-robot"></i> AI Code Assistant</h1>
      <p>Get AI-powered code suggestions, explanations, and improvements for your programming tasks.</p>
    </div>
    
    <div class="assistant-container">
      <div class="input-section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-code"></i> Your Code</h2>
          <select class="language-selector" id="languageSelector">
            <option value="javascript">JavaScript</option>
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="c">C</option>
            <option value="cpp">C++</option>
            <option value="csharp">C#</option>
            <option value="php">PHP</option>
            <option value="ruby">Ruby</option>
            <option value="swift">Swift</option>
            <option value="go">Go</option>
            <option value="rust">Rust</option>
            <option value="typescript">TypeScript</option>
          </select>
        </div>
        <div class="code-container">
          <textarea id="codeInput">// Enter your code here
// For example:
function greet(name) {
  return `Hello, ${name}!`;
}

console.log(greet('Developer'));</textarea>
        </div>
        <div class="controls">
          <div>
            <button class="action-btn clear-btn" id="clearBtn">
              <i class="fas fa-eraser"></i> Clear
            </button>
          </div>
          <div style="display:flex; gap:10px; flex-wrap: wrap;">
            <button class="action-btn generate-btn" id="generateBtn">
              <i class="fas fa-magic"></i> Get AI Assistance
            </button>
            <button class="action-btn" id="settingsBtn" style="background:#f7f7f9; color:#2c3e50; border:1px solid #e5e7eb;">
              <i class="fas fa-cog"></i> AI Settings
            </button>
          </div>
        </div>
      </div>
      
      <div class="output-section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-lightbulb"></i> AI Suggestions</h2>
        </div>
        <div class="code-container">
          <div id="outputPlaceholder" class="output-placeholder">
            <i class="fas fa-robot" style="font-size: 2rem; margin-bottom: 10px; color: #bdc3c7;"></i>
            <p>Your AI-powered code suggestions will appear here.</p>
            <p>Try asking for code improvements, explanations, or new features!</p>
          </div>
          <div id="outputContent" class="generated-text"></div>
          <div class="loading" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <p>Analyzing your code...</p>
          </div>
        </div>
        <div class="error-message" id="errorMessage"></div>
      </div>
    </div>
    
    <div class="suggestions">
      <h3>Try asking:</h3>
      <div class="suggestion-tags">
        <div class="suggestion-tag">Explain this code</div>
        <div class="suggestion-tag">Optimize for performance</div>
        <div class="suggestion-tag">Find bugs</div>
        <div class="suggestion-tag">Add error handling</div>
        <div class="suggestion-tag">Refactor this code</div>
        <div class="suggestion-tag">Add comments</div>
      </div>
    </div>
    
    <div class="coming-soon-banner">
      <p><i class="fas fa-info-circle"></i> This is a demo version. The full AI Code Assistant will be available soon with advanced features and capabilities.</p>
    </div>
  </main>
  
  <!-- Settings Modal -->
  <div id="settingsModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000;">
    <div style="background: #fff; width: min(520px, 92vw); border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden;">
      <div style="padding: 16px 20px; border-bottom: 1px solid #eee; display:flex; align-items:center; justify-content:space-between;">
        <div style="display:flex; align-items:center; gap:8px;">
          <i class="fas fa-cog" style="color:#4a6cf7;"></i>
          <strong>AI Settings</strong>
        </div>
        <button id="closeSettingsBtn" class="action-btn" style="background: transparent; color:#7f8c8d;">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
      <div style="padding: 18px 20px 6px;">
        <div class="control-group" style="margin-bottom: 14px;">
          <label for="openaiKey" style="font-weight:600;">OpenAI API Key</label>
          <input id="openaiKey" type="password" placeholder="sk-..." style="width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:6px; font-size:0.95rem;" />
          <small style="display:block; color:#7f8c8d; margin-top:6px;">Stored locally in your browser and used only from your device.</small>
        </div>
      </div>
      <div style="padding: 12px 20px 18px; display:flex; gap:10px; justify-content:flex-end;">
        <button id="clearSettingsBtn" class="action-btn" style="background:#fde8e8; color:#e74c3c;">
          <i class="fas fa-trash"></i>
          <span>Clear</span>
        </button>
        <button id="saveSettingsBtn" class="action-btn" style="background:#4a6cf7; color:#fff;">
          <i class="fas fa-save"></i>
          <span>Save</span>
        </button>
      </div>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/ruby/ruby.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/swift/swift.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/go/go.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/rust/rust.min.js"></script>
  <script src="../js/include.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize CodeMirror
      const codeInput = document.getElementById('codeInput');
      const languageSelector = document.getElementById('languageSelector');
      const generateBtn = document.getElementById('generateBtn');
      const clearBtn = document.getElementById('clearBtn');
      const outputPlaceholder = document.getElementById('outputPlaceholder');
      const outputContent = document.getElementById('outputContent');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const errorMessage = document.getElementById('errorMessage');
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsModal = document.getElementById('settingsModal');
      const openaiKeyInput = document.getElementById('openaiKey');
      const saveSettingsBtn = document.getElementById('saveSettingsBtn');
      const clearSettingsBtn = document.getElementById('clearSettingsBtn');
      const closeSettingsBtn = document.getElementById('closeSettingsBtn');
      
      let editor = CodeMirror.fromTextArea(codeInput, {
        lineNumbers: true,
        mode: 'javascript',
        theme: 'dracula',
        lineWrapping: true,
        indentUnit: 4,
        tabSize: 4,
        extraKeys: {
          'Ctrl-Enter': generateCodeSuggestion,
          'Cmd-Enter': generateCodeSuggestion
        }
      });
      
      // Set editor height
      editor.setSize('100%', '400px');
      
      // Language mode mapping
      const languageModes = {
        'javascript': 'javascript',
        'python': 'python',
        'java': 'text/x-java',
        'c': 'text/x-csrc',
        'cpp': 'text/x-c++src',
        'csharp': 'text/x-csharp',
        'php': 'php',
        'ruby': 'ruby',
        'swift': 'swift',
        'go': 'go',
        'rust': 'rust',
        'typescript': 'text/typescript'
      };
      
      // Change editor mode when language changes
      languageSelector.addEventListener('change', function() {
        const mode = languageModes[this.value] || 'javascript';
        editor.setOption('mode', mode);
      });
      
      // Generate code suggestion
      function generateCodeSuggestion() {
        const code = editor.getValue();
        const language = languageSelector.value;
        
        if (!code.trim()) {
          showError('Please enter some code first.');
          return;
        }
        
        // Show loading state
        loadingIndicator.style.display = 'block';
        outputPlaceholder.style.display = 'none';
        outputContent.style.display = 'none';
        errorMessage.style.display = 'none';
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
        
        // If OpenAI key present, call API; otherwise run demo
        if (hasApi()) {
          generateWithOpenAI(code, language)
            .then(suggestions => displaySuggestions(suggestions))
            .catch(err => { showError(typeof err === 'string' ? err : 'Failed to generate suggestions.'); console.error(err); })
            .finally(() => {
              loadingIndicator.style.display = 'none';
              generateBtn.disabled = false;
              generateBtn.innerHTML = '<i class="fas fa-magic"></i> Get AI Assistance';
            });
        } else {
          setTimeout(() => {
            try {
              const response = {
                success: true,
                suggestions: [
                  { type: 'explanation', content: 'This is a simple greeting function that takes a name parameter and returns a greeting message. (Demo output)' },
                  { type: 'improvement', content: 'Consider adding input validation to handle missing or non-string names.' },
                  { type: 'code', content: (language === 'javascript') ? (
`// Improved version with input validation
function greet(name = "Guest") {
  if (typeof name !== "string") {
    return "Error: Name must be a string";
  }
  return "Hello, " + String(name).trim() + "!";
}
console.log(greet("Developer"));
console.log(greet());
console.log(greet(123));`
                  ) : '// Similar improvements would be shown in the selected language' }
                ]
              };
              displaySuggestions(response.suggestions);
            } catch (err) {
              showError('An error occurred while generating suggestions. Please try again.');
            } finally {
              loadingIndicator.style.display = 'none';
              generateBtn.disabled = false;
              generateBtn.innerHTML = '<i class="fas fa-magic"></i> Get AI Assistance';
            }
          }, 800);
        }
      }

      // Settings helpers (reuse key with other tools)
      const STORAGE_KEYS = { openai: 'aiimage_openai_key' };
      function getOpenAIKey(){ try { return localStorage.getItem(STORAGE_KEYS.openai) || ''; } catch(_) { return ''; } }
      function setOpenAIKey(v){ try { localStorage.setItem(STORAGE_KEYS.openai, v || ''); } catch(_) {} }
      function hasApi(){ return !!getOpenAIKey(); }

      async function generateWithOpenAI(code, language){
        const key = getOpenAIKey();
        if (!key) throw 'OpenAI API key not set. Click AI Settings to add your key.';
        const sys = 'You are an expert programming assistant. Provide clear explanations, concrete improvements, and corrected code when asked. Keep answers concise and practical.';
        const user = `Language: ${language}\n\nCode:\n\n${code}\n\nTasks:\n1) Explain what this code does.\n2) Suggest improvements and potential bugs.\n3) Provide an improved version of the code.`;
        const body = {
          model: 'gpt-4o-mini',
          messages: [
            { role: 'system', content: sys },
            { role: 'user', content: user }
          ],
          temperature: 0.4
        };
        const resp = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${key}` },
          body: JSON.stringify(body)
        });
        if (!resp.ok){
          let msg = `OpenAI API error (${resp.status})`;
          try { const j = await resp.json(); if (j?.error?.message) msg += `: ${j.error.message}`; } catch(_){}
          throw msg;
        }
        const data = await resp.json();
        const text = data?.choices?.[0]?.message?.content || '';
        if (!text) throw 'Empty response from OpenAI.';
        // Parse into suggestions: explanation, improvement, code (simple split)
        const suggestions = [];
        const parts = text.split(/```/);
        // Explanation and improvements as first block
        suggestions.push({ type: 'explanation', content: (parts[0] || text).trim() });
        // If code block present, add as code
        if (parts.length >= 3) {
          const codeBlock = parts[1].includes('\n') ? parts[1].split('\n').slice(1).join('\n') : parts[1];
          suggestions.push({ type: 'code', content: codeBlock.trim() });
        }
        return suggestions;
      }
      
      // Display AI suggestions
      function displaySuggestions(suggestions) {
        outputContent.innerHTML = '';
        
        suggestions.forEach((suggestion, index) => {
          const suggestionEl = document.createElement('div');
          suggestionEl.className = 'suggestion';
          
          let content = '';
          if (suggestion.type === 'code') {
            content = `<pre><code class="language-${languageSelector.value}">${suggestion.content}</code></pre>`;
          } else {
            content = `<p>${suggestion.content}</p>`;
          }
          
          suggestionEl.innerHTML = `
            <div class="suggestion-header">
              <span class="suggestion-type">${suggestion.type}</span>
            </div>
            <div class="suggestion-content">${content}</div>
          `;
          
          outputContent.appendChild(suggestionEl);
        });
        
        outputPlaceholder.style.display = 'none';
        outputContent.style.display = 'block';
      }
      
      // Show error message
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        
        // Hide error after 5 seconds
        setTimeout(() => {
          errorMessage.style.display = 'none';
        }, 5000);
      }

      // Settings modal wiring
      function openSettings(){ settingsModal.style.display = 'flex'; openaiKeyInput.value = getOpenAIKey(); }
      function closeSettings(){ settingsModal.style.display = 'none'; }
      if (settingsBtn) settingsBtn.addEventListener('click', openSettings);
      if (closeSettingsBtn) closeSettingsBtn.addEventListener('click', closeSettings);
      if (saveSettingsBtn) saveSettingsBtn.addEventListener('click', function(){ setOpenAIKey(openaiKeyInput.value.trim()); closeSettings(); });
      if (clearSettingsBtn) clearSettingsBtn.addEventListener('click', function(){ setOpenAIKey(''); openaiKeyInput.value=''; });
      
      // Clear code editor
      clearBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to clear the editor?')) {
          editor.setValue('');
          outputPlaceholder.style.display = 'flex';
          outputContent.style.display = 'none';
          errorMessage.style.display = 'none';
        }
      });
      
      // Generate button click handler
      generateBtn.addEventListener('click', generateCodeSuggestion);
    });
  </script>
</body>
</html>



<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDF Merger & Splitter - One Click Tools</title>
  <link rel="stylesheet" href="../css/style.css"/>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    input[type=file]{padding:10px;border:1px solid #ddd;border-radius:8px;background:#fff}
  </style>
</head>
<body>
  <div id="site-header"></div>
  <main class="container" style="padding:60px 0;">
    <div class="tool-card" style="max-width:950px;margin:0 auto;">
      <div style="text-align:center;margin-bottom:10px;">
        <div class="tool-name">PDF Merger & Splitter</div>
        <div class="tool-desc">Merge multiple PDFs into one. Split by page range. All in your browser.</div>
      </div>
      <div class="tool-card" style="padding:16px;">
        <div class="grid">
          <div>
            <label>Merge PDFs</label>
            <input id="mergeFiles" type="file" accept="application/pdf" multiple/>
            <div style="margin-top:8px;text-align:right;">
              <button id="mergeBtn" class="tool-button">Merge</button>
            </div>
          </div>
          <hr/>
          <div>
            <label>Split PDF</label>
            <input id="splitFile" type="file" accept="application/pdf"/>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <input id="range" type="text" placeholder="e.g., 1-3,5,7-10" style="flex:1;padding:10px;border:1px solid #ddd;border-radius:8px"/>
              <button id="splitBtn" class="tool-button">Split</button>
            </div>
          </div>
        </div>
      </div>
      <div class="banner-ad" style="margin-top:16px;">Ad Placeholder (728x90)</div>
      <div style="text-align:center;margin-top:8px;"><a class="tool-button" href="../index.html">Back to Home</a></div>
    </div>
  </main>
  <div id="site-footer"></div>
  <script src="../js/include.js"></script>
  <script>
    function save(data, name){ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([data],{type:'application/pdf'})); a.download=name; a.click(); }
    async function readFile(file){ return new Uint8Array(await file.arrayBuffer()); }

    document.getElementById('mergeBtn').addEventListener('click', async ()=>{
      const files=[...document.getElementById('mergeFiles').files];
      if(files.length<2){ alert('Select at least two PDFs'); return; }
      const merged = await PDFLib.PDFDocument.create();
      for(const f of files){
        const bytes = await readFile(f);
        const pdf = await PDFLib.PDFDocument.load(bytes);
        const pages = await merged.copyPages(pdf, pdf.getPageIndices());
        pages.forEach(p=>merged.addPage(p));
      }
      const out = await merged.save();
      save(out, 'merged.pdf');
    });

    function parseRanges(rangeStr, max){
      const parts = rangeStr.split(',').map(s=>s.trim()).filter(Boolean);
      const set = new Set();
      for(const p of parts){
        const m=p.match(/^(\d+)(?:-(\d+))?$/);
        if(!m) continue; let a=parseInt(m[1]), b=m[2]?parseInt(m[2]):a; if(a>b) [a,b]=[b,a];
        for(let i=a;i<=b;i++){ if(i>=1 && (!max || i<=max)) set.add(i-1); }
      }
      return [...set].sort((x,y)=>x-y);
    }

    document.getElementById('splitBtn').addEventListener('click', async ()=>{
      const f = document.getElementById('splitFile').files[0];
      if(!f){ alert('Choose a PDF'); return; }
      const range = (document.getElementById('range').value||'').trim();
      const bytes = await readFile(f);
      const pdf = await PDFLib.PDFDocument.load(bytes);
      const idxs = range? parseRanges(range, pdf.getPageCount()) : pdf.getPageIndices();
      const out = await PDFLib.PDFDocument.create();
      const pages = await out.copyPages(pdf, idxs);
      pages.forEach(p=>out.addPage(p));
      const data = await out.save();
      save(data, 'split.pdf');
    });
  </script>
</body></html>



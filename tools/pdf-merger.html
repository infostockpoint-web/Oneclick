<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Merger & Splitter — One Click</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }
    .card { background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.05); }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
</head>
<body>
<div id="header-container"></div>
<main class="tool-container">
  <div class="tool-header"><h1>PDF Merger & Splitter</h1><p>Merge multiple PDFs or split pages — all in your browser using pdf-lib.</p></div>
  <div class="tool-interface">
    <div class="grid">
      <div class="card">
        <h3 class="mb-2">Merge PDFs</h3>
        <div class="form-group"><label for="mergeFiles">Select PDF files (order matters)</label><input id="mergeFiles" class="form-control" type="file" accept="application/pdf" multiple></div>
        <button id="mergeBtn" class="btn btn-primary mt-2">Merge and Download</button>
        <div class="result-area mt-2" id="mergeStatus">Status: idle</div>
      </div>
      <div class="card">
        <h3 class="mb-2">Split PDF</h3>
        <div class="form-group"><label for="splitFile">Select a PDF</label><input id="splitFile" class="form-control" type="file" accept="application/pdf"></div>
        <div class="form-group"><label for="ranges">Page ranges (e.g., 1-3,5,7-9)</label><input id="ranges" class="form-control" placeholder="1-3,5"></div>
        <button id="splitBtn" class="btn btn-primary mt-2">Split and Download</button>
        <div class="result-area mt-2" id="splitStatus">Status: idle</div>
      </div>
    </div>
  </div>
  <div class="ad-space"><h4>Advertisement</h4><p>300x250</p></div>
</main>
<div id="footer-container"></div>
<script src="../assets/js/common.js"></script>
<script>
  const { PDFDocument } = PDFLib;

  async function readFileAsUint8(file){
    return new Uint8Array(await file.arrayBuffer());
  }

  document.getElementById('mergeBtn').addEventListener('click', async ()=>{
    const input = document.getElementById('mergeFiles');
    const status = document.getElementById('mergeStatus');
    if (!input.files || input.files.length < 2){ showNotification('Select at least two PDFs', 'error'); return; }
    try{
      status.textContent = 'Status: merging...';
      const outDoc = await PDFDocument.create();
      for (const file of input.files){
        const bytes = await readFileAsUint8(file);
        const srcDoc = await PDFDocument.load(bytes);
        const pages = await outDoc.copyPages(srcDoc, srcDoc.getPageIndices());
        pages.forEach(p => outDoc.addPage(p));
      }
      const outBytes = await outDoc.save();
      const blob = new Blob([outBytes], {type:'application/pdf'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'merged.pdf'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
      status.textContent = 'Status: done'; showNotification('Merged PDF downloaded', 'success');
    } catch(e){ status.textContent = 'Status: error'; showNotification('Failed to merge PDF','error'); }
  });

  function parseRanges(rangesStr, total){
    const out = [];
    const parts = rangesStr.split(',').map(s=>s.trim()).filter(Boolean);
    for (const part of parts){
      if (/^\d+$/.test(part)){
        const n = parseInt(part,10); if (n>=1 && n<=total) out.push(n);
      } else if (/^(\d+)-(\d+)$/.test(part)){
        const [,a,b] = part.match(/(\d+)-(\d+)/);
        let start = Math.max(1, parseInt(a,10)), end = Math.min(total, parseInt(b,10));
        if (start> end) [start,end] = [end,start];
        for (let i=start;i<=end;i++) out.push(i);
      }
    }
    return Array.from(new Set(out));
  }

  document.getElementById('splitBtn').addEventListener('click', async ()=>{
    const fileInput = document.getElementById('splitFile');
    const status = document.getElementById('splitStatus');
    const ranges = document.getElementById('ranges').value.trim();
    if (!fileInput.files || fileInput.files.length === 0){ showNotification('Select a PDF', 'error'); return; }
    try{
      status.textContent = 'Status: splitting...';
      const bytes = await readFileAsUint8(fileInput.files[0]);
      const srcDoc = await PDFDocument.load(bytes);
      const total = srcDoc.getPageCount();
      const pageNums = ranges ? parseRanges(ranges, total) : Array.from({length: total}, (_,i)=>i+1);
      // Create a new doc for each page number sequence individually
      for (const num of pageNums){
        const outDoc = await PDFDocument.create();
        const [page] = await outDoc.copyPages(srcDoc, [num-1]);
        outDoc.addPage(page);
        const outBytes = await outDoc.save();
        const blob = new Blob([outBytes], {type:'application/pdf'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `page-${num}.pdf`; a.click();
        setTimeout(()=>URL.revokeObjectURL(url), 500);
      }
      status.textContent = 'Status: done'; showNotification('Split PDFs downloaded', 'success');
    } catch(e){ status.textContent = 'Status: error'; showNotification('Failed to split PDF','error'); }
  });
</script>
</body>
</html>

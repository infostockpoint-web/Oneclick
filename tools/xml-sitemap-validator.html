<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XML Sitemap Validator â€” One Click</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <style>
    .grid { display:grid; grid-template-columns:1fr; gap:12px; }
    .ok { color:#28a745; font-weight:600; }
    .err { color:#dc3545; font-weight:600; }
    .list { max-height:220px; overflow:auto; background:#fff;border:1px solid #e9ecef;border-radius:8px;padding:10px; }
    .list div { padding:4px 0; border-bottom:1px dashed #eee; }
  </style>
</head>
<body>
  <div id="header-container"></div>

  <main class="tool-container">
    <div class="tool-header">
      <h1>XML Sitemap Validator</h1>
      <p>Validate a sitemap by URL or paste XML content. Checks basic structure and URL entries.</p>
    </div>

    <div class="tool-interface">
      <div class="grid">
        <div class="form-group">
          <label for="sitemapUrl">Sitemap URL</label>
          <input id="sitemapUrl" class="form-control" placeholder="https://example.com/sitemap.xml" />
          <button id="fetchBtn" class="btn btn-primary mt-2">Fetch & Validate</button>
        </div>
        <div class="form-group">
          <label for="xmlInput">Or paste XML</label>
          <textarea id="xmlInput" class="form-control" rows="10" placeholder="<?xml version='1.0' encoding='UTF-8'?>\n<urlset xmlns='http://www.sitemaps.org/schemas/sitemap/0.9'>\n  <url><loc>https://example.com/</loc></url>\n</urlset>"></textarea>
          <button id="validateBtn" class="btn btn-primary mt-2">Validate XML</button>
        </div>
      </div>

      <div class="result-area mt-3" id="status">Status: idle</div>
      <div class="list mt-2" id="issues"></div>
    </div>

    <div class="ad-space"><h4>Advertisement</h4><p>300x250</p></div>
  </main>

  <div id="footer-container"></div>

  <script src="../assets/js/common.js"></script>
  <script>
    function parseAndValidate(xmlText){
      const issues = [];
      try{
        const parser = new DOMParser();
        const doc = parser.parseFromString(xmlText, 'application/xml');
        const parseError = doc.querySelector('parsererror');
        if (parseError) {
          issues.push({type:'error', msg:'XML parse error: ' + parseError.textContent.trim().slice(0,200)});
          return {ok:false, issues};
        }
        const urlset = doc.querySelector('urlset');
        const sitemapindex = doc.querySelector('sitemapindex');
        if (!urlset && !sitemapindex) {
          issues.push({type:'error', msg:'Missing <urlset> or <sitemapindex> root element.'});
        }
        const locs = doc.querySelectorAll('loc');
        if (locs.length === 0) {
          issues.push({type:'warning', msg:'No <loc> entries found.'});
        }
        // Check each URL is absolute
        locs.forEach(loc => {
          const val = (loc.textContent||'').trim();
          if (!/^https?:\/\//i.test(val)) {
            issues.push({type:'warning', msg:`Non-absolute URL detected: ${val}`});
          }
        });
        return {ok: issues.length === 0, issues};
      }catch(e){
        issues.push({type:'error', msg:'Exception: ' + e.message});
        return {ok:false, issues};
      }
    }

    function render(status, issues){
      document.getElementById('status').innerHTML = status;
      const box = document.getElementById('issues');
      if (!issues || !issues.length) { box.innerHTML = '<div class="ok">No issues found</div>'; return; }
      box.innerHTML = issues.map(i => `<div class="${i.type==='error'?'err':'ok'}">${i.type.toUpperCase()}: ${i.msg}</div>`).join('');
    }

    async function fetchAndValidate(){
      const url = document.getElementById('sitemapUrl').value.trim();
      if (!url) return showNotification('Enter a sitemap URL', 'error');
      try{
        document.getElementById('status').textContent = 'Status: fetching...';
        const res = await fetch(url);
        const txt = await res.text();
        const result = parseAndValidate(txt);
        render(result.ok ? 'Status: valid' : 'Status: issues found', result.issues);
        showNotification(result.ok ? 'Sitemap valid' : 'Sitemap has issues', result.ok ? 'success' : 'error');
      }catch(e){
        render('Status: network error', [{type:'error', msg:'Fetch failed: ' + e.message}]);
        showNotification('Network error', 'error');
      }
    }

    function validateTextarea(){
      const txt = document.getElementById('xmlInput').value;
      const result = parseAndValidate(txt);
      render(result.ok ? 'Status: valid' : 'Status: issues found', result.issues);
      showNotification(result.ok ? 'Sitemap valid' : 'Sitemap has issues', result.ok ? 'success' : 'error');
    }

    document.getElementById('fetchBtn').addEventListener('click', fetchAndValidate);
    document.getElementById('validateBtn').addEventListener('click', validateTextarea);
  </script>
</body>
</html>

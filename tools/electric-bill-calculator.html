<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Electric Bill Calculator - One Click Tools</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="../css/style.css"/>
  <style>
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;align-items:end}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f3f3f3;text-align:left}
  </style>
</head>
<body>
  <div id="site-header"></div>
  <main class="container" style="padding:60px 0;">
    <div class="tool-card" style="max-width:1100px;margin:0 auto;">
      <div style="text-align:center;margin-bottom:10px;">
        <i class="fas fa-bolt tool-icon-small" style="font-size:3rem;"></i>
        <div class="tool-name" style="font-size:1.6rem;">Electric Bill Calculator</div>
        <div class="tool-desc">Estimate bill using customizable slabs, fixed charge, and tax. Saved locally.</div>
      </div>

      <div class="tool-card" style="padding:16px;">
        <div class="grid">
          <div><label style="display:block;font-weight:600;margin-bottom:6px;">Units (kWh)</label><input id="units" type="number" min="0" step="0.01" value="250" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px"></div>
          <div><label style="display:block;font-weight:600;margin-bottom:6px;">Fixed Charge</label><input id="fixed" type="number" min="0" step="0.01" value="100" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px"></div>
          <div><label style="display:block;font-weight:600;margin-bottom:6px;">Tax (%)</label><input id="tax" type="number" min="0" step="0.01" value="5" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px"></div>
          <button id="calc" class="tool-button"><i class="fas fa-calculator"></i> Calculate</button>
        </div>
      </div>

      <div class="tool-card" style="padding:16px;">
        <div class="tool-name" style="margin-bottom:6px;">Slab Rates</div>
        <table>
          <thead><tr><th>Up to (kWh)</th><th>Rate per kWh</th><th></th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;">
          <button id="addSlab" class="tool-button"><i class="fas fa-plus"></i> Add Slab</button>
          <button id="saveCfg" class="tool-button"><i class="fas fa-save"></i> Save Config</button>
          <button id="resetCfg" class="tool-button" style="background:#e74c3c;"><i class="fas fa-trash"></i> Reset</button>
        </div>
      </div>

      <div class="tool-card" style="padding:16px;">
        <div class="tool-name">Breakdown</div>
        <div id="out" class="tool-desc" style="font-size:1.1rem;color:#000;white-space:pre-wrap">â€”</div>
      </div>

      <div class="banner-ad" style="margin-top:16px;">Ad Placeholder (728x90)</div>
      <div style="text-align:center;margin-top:8px;"><a class="tool-button" href="../index.html">Back to Home</a></div>
    </div>
  </main>
  <div id="site-footer"></div>
  <script src="../js/include.js"></script>
  <script>
    const KEY='oneclick_elec_bill_v1';
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY))||{slabs:[{limit:100, rate:3.5},{limit:200, rate:5.5},{limit:Infinity, rate:7.5}], fixed:100, tax:5} }catch(e){ return {slabs:[], fixed:0, tax:0} } }
    function save(d){ localStorage.setItem(KEY, JSON.stringify(d)); }

    function render(){ const d=load(); document.getElementById('fixed').value=d.fixed||0; document.getElementById('tax').value=d.tax||0; const tb=document.getElementById('tbody'); tb.innerHTML='';
      d.slabs.forEach((s,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td><input data-k="limit" data-i="${i}" type="number" ${s.limit===Infinity?'disabled':''} value="${s.limit===Infinity?'âˆž':s.limit}" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:8px"></td>
        <td><input data-k="rate" data-i="${i}" type="number" step="0.01" value="${s.rate}" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:8px"></td>
        <td><button class="tool-button" data-del="${i}" style="background:#e74c3c;" ${s.limit===Infinity?'disabled':''}><i class="fas fa-trash"></i></button></td>`; tb.appendChild(tr); }); }

    function updateField(e){ const inp=e.target.closest('input[data-k]'); if(!inp) return; const d=load(); const i=+inp.getAttribute('data-i'); const k=inp.getAttribute('data-k'); let v=inp.value; if(k==='limit'){ if(v==='âˆž' || v==='') return; d.slabs[i].limit=Math.max(0, +v||0); } else { d.slabs[i].rate=+v||0; } save(d); }
    function addSlab(){ const d=load(); const last=d.slabs[d.slabs.length-1]; if (last && last.limit===Infinity){ d.slabs.splice(d.slabs.length-1,0,{limit:(d.slabs[d.slabs.length-2]?.limit||100)+100, rate:last.rate}); } else { d.slabs.push({limit:100, rate:3}); } save(d); render(); }
    function delSlab(i){ const d=load(); d.slabs.splice(i,1); // ensure Infinity at end
      if (!d.slabs.some(s=>s.limit===Infinity)) d.slabs.push({limit:Infinity, rate:d.slabs[d.slabs.length-1]?.rate||0}); save(d); render(); }
    function saveCfg(){ const d=load(); d.fixed=+document.getElementById('fixed').value||0; d.tax=+document.getElementById('tax').value||0; // ensure sorted and Infinity last
      d.slabs.sort((a,b)=> (a.limit===Infinity? Number.MAX_SAFE_INTEGER:a.limit) - (b.limit===Infinity? Number.MAX_SAFE_INTEGER:b.limit)); if (d.slabs[d.slabs.length-1]?.limit!==Infinity) d.slabs.push({limit:Infinity, rate:d.slabs[d.slabs.length-1]?.rate||0}); save(d); alert('Saved.'); }
    function resetCfg(){ if(!confirm('Reset config to defaults?')) return; localStorage.removeItem(KEY); render(); document.getElementById('out').textContent='â€”'; }

    function calc(){ const units=+document.getElementById('units').value||0; const d=load(); let rem=units, prev=0; let energy=0; let lines=[]; for(const s of d.slabs){ const cap = s.limit===Infinity? rem: Math.max(0, Math.min(rem, s.limit - prev)); if (cap>0){ const cost=cap*s.rate; energy+=cost; lines.push(`${cap} kWh @ ${s.rate}/kWh = ${cost.toFixed(2)}`); rem-=cap; prev = s.limit===Infinity? prev: s.limit; } }
      const fixed=+document.getElementById('fixed').value||0; const sub=energy+fixed; const tax=(+document.getElementById('tax').value||0)/100*sub; const total=sub+tax; const out=`Energy Charges:\n${lines.join('\n')||'â€”'}\nFixed: ${fixed.toFixed(2)}\nSubtotal: ${sub.toFixed(2)}\nTax (${d.tax||0}%): ${tax.toFixed(2)}\n\nTotal: ${total.toFixed(2)}`; document.getElementById('out').textContent=out; }

    document.getElementById('tbody').addEventListener('input', updateField);
    document.getElementById('tbody').addEventListener('click',(e)=>{ const b=e.target.closest('button[data-del]'); if(!b) return; delSlab(+b.getAttribute('data-del')); });
    document.getElementById('addSlab').addEventListener('click', addSlab);
    document.getElementById('saveCfg').addEventListener('click', saveCfg);
    document.getElementById('resetCfg').addEventListener('click', resetCfg);
    document.getElementById('calc').addEventListener('click', calc);

    render();
  </script>
</body>
</html>



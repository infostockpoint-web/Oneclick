<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GIF Maker â€” One Click</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <link rel="icon" href="../assets/images/favicon.ico" />
</head>
<body>
  <div id="header-container"></div>

  <main class="tool-container">
    <div class="tool-header">
      <h1>GIF Maker</h1>
      <p>Create an animated GIF from multiple images in your browser. No upload required.</p>
    </div>

    <div class="tool-interface">
      <div class="form-group">
        <label for="imgInput">Select images (order matters)</label>
        <input id="imgInput" type="file" accept="image/*" class="form-control" multiple />
      </div>

      <div class="d-flex" style="gap:10px;flex-wrap:wrap;">
        <div>
          <label for="delay">Frame delay (ms)</label>
          <input id="delay" type="number" class="form-control" value="200" min="20" />
        </div>
        <div>
          <label for="quality">Quality (1=best)</label>
          <input id="quality" type="number" class="form-control" value="10" min="1" max="30" />
        </div>
        <div>
          <label for="repeat">Repeat</label>
          <select id="repeat" class="form-control">
            <option value="0" selected>Loop Forever</option>
            <option value="-1">No Loop</option>
          </select>
        </div>
      </div>

      <div class="d-flex mt-3" style="gap:10px;flex-wrap:wrap;">
        <button id="makeBtn" class="btn btn-primary">Make GIF</button>
        <button id="downloadBtn" class="btn btn-success" disabled>Download GIF</button>
      </div>

      <div class="result-area mt-3 text-center">
        <div id="preview"></div>
        <div id="status" class="mt-2" style="color:#6c757d;"></div>
      </div>
    </div>

    <div class="ad-space"><h4>Advertisement</h4><p>300x250</p></div>
  </main>

  <div id="footer-container"></div>

  <script src="../assets/js/common.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js"></script>
  <script>
    const fileInput = document.getElementById('imgInput');
    const makeBtn = document.getElementById('makeBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const preview = document.getElementById('preview');
    const statusEl = document.getElementById('status');

    let lastBlobUrl = null;

    function loadImages(files) {
      return Promise.all(Array.from(files).map(f => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(f);
      })));
    }

    makeBtn.addEventListener('click', async () => {
      const files = fileInput.files;
      if (!files || files.length === 0) return showNotification('Please select images', 'error');
      statusEl.textContent = 'Loading images...';

      try {
        const images = await loadImages(files);
        statusEl.textContent = 'Rendering GIF...';

        // Use first image size as canvas size
        const width = images[0].width;
        const height = images[0].height;

        const delay = Math.max(20, parseInt(document.getElementById('delay').value, 10) || 200);
        const quality = Math.max(1, Math.min(30, parseInt(document.getElementById('quality').value, 10) || 10));
        const repeat = parseInt(document.getElementById('repeat').value, 10);

        const gif = new GIF({
          workers: 2,
          quality: quality,
          workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js',
          width,
          height,
          repeat
        });

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = width; canvas.height = height;

        images.forEach(img => {
          ctx.clearRect(0,0,width,height);
          ctx.drawImage(img, 0, 0, width, height);
          gif.addFrame(ctx, {copy: true, delay});
        });

        gif.on('finished', function(blob) {
          if (lastBlobUrl) URL.revokeObjectURL(lastBlobUrl);
          const url = URL.createObjectURL(blob);
          lastBlobUrl = url;
          preview.innerHTML = `<img src="${url}" alt="GIF preview" style="max-width:100%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);"/>`;
          downloadBtn.disabled = false;
          statusEl.textContent = 'GIF ready!';
          showNotification('GIF created successfully', 'success');
        });

        gif.render();
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'Failed to create GIF';
        showNotification('Failed to create GIF', 'error');
      }
    });

    downloadBtn.addEventListener('click', () => {
      if (!lastBlobUrl) return;
      const a = document.createElement('a');
      a.href = lastBlobUrl; a.download = 'animation.gif'; a.click();
    });
  </script>
</body>
</html>
